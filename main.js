(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{M:()=>$});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",cardsUrl:"/cards",usersUrl:"/users",meUrl:"/me",likesUrl:"/likes",avatarUrl:"/avatar",headers:{authorization:"51a21100-cb43-4102-be63-22dae278b0b1","Content-Type":"application/json"}};function n(e,t){return e.ok?e.json():Promise.reject({response:e,message:t||"Ошибка при получении данных"})}function r(e,r,o){var a=e.querySelector(".card__like-button");a.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl).concat(t.cardsUrl).concat(t.likesUrl,"/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return n(e,"Ошибка при удаления лайка")}))}(r).then((function(e){a.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})):function(e){return fetch("".concat(t.baseUrl).concat(t.cardsUrl).concat(t.likesUrl,"/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return n(e,"Ошибка добавления лайка")}))}(r).then((function(e){a.classList.add("card__like-button_is-active"),o.textContent=e.likes.length}))}function o(e,t,n,r,o){var a=e.name,c=e.link,i=e.likes,u=e._id,s=e.owner,l=n.querySelector(".card").cloneNode(!0),d=l.querySelector(".card__image"),f=l.querySelector(".card__title"),p=l.querySelector(".card__like-count"),m=l.querySelector(".card__delete-button"),v=l.querySelector(".card__like-button");return f.textContent=a,p.textContent=i.length,d.src=c,d.alt=a,s._id===t._id&&(m.style.display="block",m.addEventListener("click",(function(){$(u,l)}))),i.some((function(e){return e._id===t._id}))&&v.classList.add("card__like-button_is-active"),v.addEventListener("click",(function(){r(l,u,p)})),o(d),l}var a=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");i(t)}},c=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)},i=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)},u=function(e){e.querySelector(".popup__close").addEventListener("click",(function(){i(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&i(e)}))},s=".popup__input",l=".popup__button",d="popup__button_disabled",f="popup__input_type_error",p="popup__error_visible",m=function(e,t,n){var r=e.querySelector("#".concat(t.name,"-error"));t.classList.add(f),r.textContent=n,r.classList.add(p)},v=function(e,t){var n=e.querySelector("#".concat(t.name,"-error"));t.classList.remove(f),n.classList.add(p),n.textContent=""},h=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(d)):(t.disabled=!0,t.classList.add(d))},_=function(e){var t=Array.from(e.querySelectorAll("".concat(s))),n=e.querySelector(l);t.forEach((function(t){v(e,t),t.setCustomValidity("")})),h(t,n)};function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var b=document.querySelector.bind(document),g=b("#current-year"),k=b("#card-template").content,E=b(".places__list"),L=b(".profile__title"),U=b(".profile__description"),S=b(".profile__image"),C=b(".popup_type_edit-avatar"),q=document.forms["new-avatar"],x=b(".profile__image-edit-button"),A=q.elements["avatar-link"],w=b(".popup_type_edit"),T=document.forms["edit-profile"],j=b(".profile__edit-button"),O=T.elements.name,P=T.elements.description,D=b(".popup_type_new-card"),M=document.forms["new-place"],I=M.elements["place-name"],N=M.elements.link,V=b(".profile__add-button"),H=b(".popup_type_delete_card"),J=document.forms["delete-card-popup"],G=b(".popup_type_image"),z=b(".popup__image"),F=b(".popup__caption"),Y={};function $(e,t){Y={id:e,cardElement:t},c(H)}function B(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Cохранение...",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cохранить";e.textContent=t?n:r}function K(e){e.addEventListener("click",(function(){var t=e.closest(".card").querySelector(".card__title").textContent;z.src=e.src,z.alt=e.alt&&""!==e.alt.trim()?e.alt:t,F.textContent=t,c(G)}))}g&&(g.textContent=(new Date).getFullYear().toString()),Promise.all([fetch("".concat(t.baseUrl).concat(t.usersUrl).concat(t.meUrl),{method:"GET",headers:t.headers}).then((function(e){return n(e,"Ошибка при получении информации профиля")})),fetch("".concat(t.baseUrl).concat(t.cardsUrl),{method:"GET",headers:t.headers}).then((function(e){return n(e,"Ошибка при получении карточек")}))]).then((function(e){var t,n,a,c,i,u,s=(u=2,function(e){if(Array.isArray(e))return e}(i=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw o}}return i}}(i,u)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(i,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=s[0],d=s[1];n=(t=l).name,a=t.about,c=t.avatar,L.textContent=n,U.textContent=a,S.style.backgroundImage="url(".concat(c,")"),d.forEach((function(e){E.append(o(e,l,k,r,K))}))})).catch((function(e){console.error("Ошибка при загрузке:",e)})),V.addEventListener("click",(function(){_(M),I.value="",N.value="",c(D)})),j.addEventListener("click",(function(){_(T),O.value=L.textContent,P.value=U.textContent,c(w)})),x.addEventListener("click",(function(){_(q),A.value="",c(C)})),u(w),u(D),u(G),u(C),u(H),T.addEventListener("submit",(function(e){var r,o;e.preventDefault(),B(e.submitter,!0),(r=O.value,o=P.value,fetch("".concat(t.baseUrl).concat(t.usersUrl).concat(t.meUrl),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:o})}).then((function(e){return n(e,"Ошибка при редактировании информации профиля")}))).then((function(e){L.textContent=e.name,U.textContent=e.about})).then((function(){i(w),setTimeout((function(){B(e.submitter,!1)}),400)})).catch((function(e){console.error("Ошибка редактирования:",e)}))})),M.addEventListener("submit",(function(e){var a,c;e.preventDefault(),B(e.submitter,!0),(a=M.elements["place-name"].value,c=M.elements.link.value,fetch("".concat(t.baseUrl).concat(t.cardsUrl),{method:"POST",headers:t.headers,body:JSON.stringify({name:a,link:c})}).then((function(e){return n(e,"Ошибка при добавлении карточки")}))).then((function(t){var n=o(t,t.owner,k,r,K);E.prepend(n),i(D),setTimeout((function(){B(e.submitter,!1)}),400),M.reset(),_(M)})).catch((function(e){console.error(e)}))})),q.addEventListener("submit",(function(e){var r;e.preventDefault(),B(e.submitter,!0),(r=A.value,fetch(r,{method:"HEAD"}).then((function(e){var t=e.headers.get("Content-Type"),n="image/jpeg"===t||"image/png"===t;return!(!e.ok||!n)||Promise.reject({message:"Ссылка недействительна или не является изображением.",status:e.status})}))).then((function(){return function(e){return fetch("".concat(t.baseUrl).concat(t.usersUrl).concat(t.meUrl).concat(t.avatarUrl),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(e){return n(e,"Ошибка редактирования аватара")}))}(A.value)})).then((function(t){S.style.backgroundImage="url(".concat(t.avatar,")"),i(C),setTimeout((function(){B(e.submitter,!1)}),400)})).catch((function(t){m(q,A,t.message),B(e.submitter,!1)}))})),J.addEventListener("submit",(function(e){var r;e.preventDefault(),Y.cardElement&&(r=Y.id,fetch("".concat(t.baseUrl).concat(t.cardsUrl,"/").concat(r),{method:"DELETE",headers:t.headers}).then((function(e){return n(e,"Ошибка при удалении карточки")}))).then((function(){Y.cardElement.remove(),i(H),Y={}})).catch((function(e){return console.error(e)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll("".concat(s))),n=e.querySelector(l);t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){if(t.validity.valueMissing)t.setCustomValidity("Вы пропустили это поле");else if(t.validity.patternMismatch||t.validity.typeMismatch){var n=t.dataset.errorMessage||t.validationMessage;t.setCustomValidity(n)}else t.setCustomValidity("");t.validity.valid?v(e,t):m(e,t,t.validationMessage)}(e,r),h(t,n)}))}))}(e)}))})();